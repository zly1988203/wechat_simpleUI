!function(t){try{t.$=$}catch(t){throw"js库必须为Zepto或jQuery"}var e={dateBase:"",gather:[],disableSwitch:!1,lock:!1,multiple:!0,before:!1,after:2,weekend:!1,selectCallback:null,highlight:!0,switchMonth:null},a=function(t,r){a.data={base:{year:"",month:"",day:"",week:""},selectData:[]},a.el=t?$(t):$(this),"object"==typeof r&&(r.gather&&("object"!=typeof r.gather||r.gather instanceof Array||(r.gather=[r.gather])),$.extend(e,r)),a.init.call(this)};a.init=function(){if(""!==e.dateBase)var t=a.formatDate(e.dateBase);else{var r=new Date;t={year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()}}a.data.base={year:t.year,month:t.month,day:t.day,week:t.week};var n=a.data.base;this.full(n)},a.prototype.reset=function(t){$.extend(e,t)},a.prototype.full=function(t){if("string"==typeof t)var r=a.formatDate(t);else{if("object"!=typeof t)throw"参数错误";r=t}var n=$('<div class="fy-date-picker">'),o=$('<div class="head">');if(""==e.dateBase)var i="disabled",d="disabled",h="",s="";else{var c,l,f=a.formatDate(e.dateBase);f.month,f.day;c=l=r.year+"-"+(r.month>=10?r.month:"0"+r.month)+"-01",c=new Date(c+"T00:00:01"),l=new Date(l+"T00:00:02"),c.setMonth(c.getMonth()-1),l.setMonth(l.getMonth()+1);i="",d="",h='data-target-month="'+(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate())+'"',s='data-target-month="'+(l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate())+'"';var g=a.createDate(f),u=new Date(c.toDateString()),m=new Date(l.toDateString());e.after<0?(u.setMonth(u.getMonth()+1+Math.abs(e.after))<g.getTime()&&(i="disabled",h=""),m.setMonth(m.getMonth())>g.getTime()&&(d="disabled",s="")):e.after>0&&(u.setMonth(u.getMonth()+1)<g.getTime()&&(i="disabled",h=""),m.setMonth(m.getMonth()-Math.abs(e.after))>g.getTime()&&(d="disabled",s="")),0==e.after&&(i="disabled",h="",d="disabled",s="")}var b="",y="";e.disableSwitch||(b+='<div class="left-btn '+i+'" '+h+">上个月</div>",y+='<div class="right-btn '+d+'" '+s+">下个月</div>");var v=b+'<div class="date">'+r.year+"年"+r.month+"月</div>"+y;n.append(o.append(v));var p=$('<table cellspacing="0" border="0" class="section">');p.append("<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>");for(var w=$("<tbody></tbody>"),D="",k=new Date(r.year,r.month-1,1).getDay(),M=new Date(r.year,r.month,0),j=M.getDate(),C=M.getDay(),T=[],x=1;x<=j;x++)T.push(x);if(0!==k)for(x=0;x<k;x++)T.unshift("");if(6!==C)for(x=0;x<6-C;x++)T.push("");var P=[];for(x=0;x<e.gather.length;x++)if(e.gather[x].comment){var B=e.gather[x];B.text=e.gather[x].comment,P.push(B)}var F=a.formatComment(r.year+"-"+r.month,P),O="",S="",A="",E="",Y="",I="",L="",Q="",Z="",q="",z="",G="",H="",J=[],K=[],N=[],R=[],U=[],V=null,W=[];for(x=0;x<e.gather.length;x++){var X=e.gather[x];if($.each(X,function(t,e){W.includes(t)||W.push(t)}),e.gather[x].state)switch(V={date:e.gather[x].date,comment:e.gather[x].comment},e.gather[x].state){case"select":K.push(V);break;case"readonly":N.push(V);break;case"disable":R.push(V);break;case"active":U.push(V),a.data.selectData.indexOf(V)<0&&a.data.selectData.push(V)}e.gather[x]["badge-left"]?(G=e.gather[x]["badge-left"],e.gather[x]["badge-left-active"]&&(H=e.gather[x]["badge-left-active"]),J.push({date:e.gather[x].date,badge:{direction:"left",source:G,active:H}})):e.gather[x]["badge-right"]&&(G=e.gather[x]["badge-right"],e.gather[x]["badge-right-active"]&&(H=e.gather[x]["badge-right-active"]),J.push({date:e.gather[x].date,badge:{direction:"right",source:G,active:H}}))}for(x=0;x<T.length;x++){q=x%7==0,z=(x+1)%7==0;var _="售罄"==(Z=it(T[x])).text?" sell-out":"",tt="有票"==Z.text?" on-sale":"";I="";for(var et in Z)I+="data-"+et+"="+Z[et]+" ";E='data-date="'+r.year+"-"+r.month+"-"+T[x]+'" ',Y="<p>"+T[x]+"</p>",L='<span class="comment'+_+tt+'">'+(null!=Z.text?Z.text:"")+"</span>",O="",S="",A="";var at="",rt=!1,nt="";if(""==T[x])E="",Y="",I="",L="",O="",S="",A="";else{e.before||T[x]<r.day&&(O=" readonly",S="",A=""),e.weekend||(q||z)&&(O=" disabled");var ot=r.year+"-"+r.month+"-"+T[x];dt(ot,K)?(O="",S='data-confirm="false" ',A='data-selectable="true" '):dt(ot,U)?(O=" active",S='data-confirm="true" ',A='data-selectable="true" '):(S="",A="",O=dt(ot,R)?" disabled":(dt(ot,N)," readonly")),rt=dt(ot,J)}""!=T[x]&&dt(r.year+"-"+r.month+"-"+T[x],a.data.selectData)&&(O=" active",S='data-confirm="true" ',A='data-selectable="true" '),e.highlight&&""!=$.trim(Z)&&(O+=" highlight"),rt&&(nt=-1!=O.search("active")?J[rt].badge.active:J[rt].badge.source,at='<div class="badge" style="'+J[rt].badge.direction+": 0.01rem; background-image: url("+nt+');"data-badge="'+J[rt].badge.source+'"data-badge-active="'+J[rt].badge.active+'"></div>'),Q+='<td class="'+$.trim(O)+'" '+$.trim(S+A+E+I)+">"+at+Y+L+"</td>"}function it(t){var e={};return F instanceof Array?F.forEach(function(r){a.formatDate(r.date).day==t&&(e=r)}):"object"==typeof F&&a.formatDate(F.date).day==t&&(e=F),e}function dt(t,e){var r=!1;if(e instanceof Array){var n={},o="",i="";try{e.forEach(function(e,d){if(o=a.formatDate(e.date),i=a.formatDate(t),o.day==i.day&&o.month==i.month&&o.year==i.year)throw r=d.toString(),n})}catch(t){if(t!=n)throw t}}else if("string"==typeof e){o=a.formatDate(t),i=a.formatDate(e);o.day==i.day&&o.month==i.month&&o.year==i.year&&(r=!0)}return r}if(D+="<tr>"+Q+"</tr>",w.append(D),n.append(p.append(w)),a.el.html("").append(n),!e.lock){var ht=a.data.selectData;function st(t){var e={};W.forEach(function(a,r){var n=a.toLowerCase();e[a]=t.data(n+"")});var r=a.formatDate(e.date);e.date=r,ht.push(e)}$("[data-selectable=true]").on("click",function(){var t=$(this),r=t.find(".badge");if(e.multiple)if(t.data("confirm")){t.data("confirm",!1),t.removeClass("active");for(var n=0;n<ht.length;n++)dt(ht[n].date,t.data("date"))&&ht.splice(n,1);1==r.length&&r.css({"background-image":"url("+r.data("badge")+")"})}else t.data("confirm",!0),t.addClass("active"),st(t),1==r.length&&r.css({"background-image":"url("+r.data("badge-active")+")"});else{if(t.data("confirm"))return;$("[data-selectable=true]").each(function(t,e){$(this).removeClass("active").data("confirm",!1),$(this).find(".badge").css({"background-image":"url("+$(this).find(".badge").data("badge")+")"})}),t.data("confirm",!0),t.addClass("active"),ht.length=0,st(t),r.css({"background-image":"url("+r.data("badge-active")+")"})}e.selectCallback instanceof Function&&e.selectCallback.call(a.el,a.data)});var ct=this;$("[data-target-month]").on("click",function(){var t=$(this),a=t.data("target-month");null!=e.switchMonth?e.switchMonth(a,ct):ct.full(t.data("target-month"))})}},a.formatDate=function(t){var e=null;if("string"==typeof t){for(var a=t.split("-"),r="",n=0;n<a.length;n++){var o=parseInt(a[n]);o<10&&(o="0"+o),n<a.length-1?r+=o+"-":r+=o}2==a.length?r+="-01T00:00:00":r+="T00:00:00";try{var i=new Date(r);switch(e={year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate()},i.getDay()){case 0:e.week="星期日";break;case 1:e.week="星期一";break;case 2:e.week="星期二";break;case 3:e.week="星期三";break;case 4:e.week="星期四";break;case 5:e.week="星期五";break;case 6:e.week="星期六"}}catch(t){throw"日期错误"}}else"object"==typeof t&&t.hasOwnProperty("year")&&t.hasOwnProperty("month")&&t.hasOwnProperty("day")&&t.hasOwnProperty("week")&&(e=t);return e},a.createDate=function(t){var e=null;if("object"==typeof t)e=new Date(t.year+"-"+(t.month>=10?t.month:"0"+t.month)+"-"+(t.day>=10?t.day:"0"+t.day)+"T00:00:01");else if("string"==typeof t){var a=t.split("-");e=new Date(a[0]+"-"+(parseInt(a[1])>=10?a[1]:"0"+a[1])+"-"+(parseInt(a[2])>=10?a[2]:"0"+a[2])+"T00:00:01")}return e},a.formatComment=function(t,e){if(e instanceof Array){var r=[];if(e.forEach(function(t){n(t)&&r.push(t)}),r.length>0)return r}else if("object"==typeof e)return n(e);function n(e){if(e.date&&e.text){var r=a.formatDate(t),n=a.formatDate(e.date);if(r.year==n.year&&r.month==n.month)return e}return!1}return!1};$.fn.datePicker=function(t){return this.each(function(){if("object"==typeof t||!t)return new a(this,t)})},$.fn.datePicker.constructor=a}(window);