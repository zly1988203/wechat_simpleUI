var zeroize=function(e){return e>9?e:"0"+e},getDate=function(e){return{text:zeroize(e.getMonth()+1)+"月"+zeroize(e.getDate())+"日",value:e.getFullYear()+"-"+zeroize(e.getMonth()+1)+"-"+zeroize(e.getDate())}},getTime=function(e,t){return{text:zeroize(e)+":"+zeroize(t),value:zeroize(e)+":"+zeroize(t)}},getNow=function(){var e=new Date((new Date).getTime());return e.setHours(e.getHours()+1),e};function configHour(){for(var e=[],t=0;t<24;t++)t<10&&(t="0"+t),e.push({value:t,text:t+"点"});return e}function configMinute(){for(var e=[],t=0;t<60;t++)t<10&&(t="0"+t),e.push({value:t,text:t+"分"});return e}function getAddDays(e){var t=new Date((new Date).getTime()),a=t.getHours(),i=Number(t.getMinutes())+Number(e.data("intervalminute")),u=Math.floor(i/60);return Math.floor((a+u)/24)}function getAddHours(e){var t=new Date((new Date).getTime()),a=t.getHours(),i=Number(t.getMinutes())+Number(e.data("intervalminute"));return a=(a+Math.floor(i/60))%24}function getAddMinutes(e){var t=new Date((new Date).getTime());t.getHours();return(Number(t.getMinutes())+Number(e.data("intervalminute")))%60}function initWeekTime(e,t){var a={},i=e;a.key=i.prop("id");var u=3;i.data("interval")&&(u=i.data("interval"));var n=new Date,r=[],l=getAddDays(i),o=getDate(n).value;0==l?(r.push({value:getDate(n).value,text:"今天"}),n.setDate(n.getDate()+1),r.push({value:getDate(n).value,text:"明天"}),n.setDate(n.getDate()+1),u-=2):1==l?(n.setDate(n.getDate()+1),o=getDate(n).value,r.push({value:getDate(n).value,text:"明天"}),n.setDate(n.getDate()+1),u-=1):(n.setDate(n.getDate()+l),o=getDate(n).value);for(var d=0;d<u;d++){var v="周"+"日一二三四五六".charAt(n.getDay());r.push({value:getDate(n).value,text:getDate(n).text+""+v}),n.setDate(n.getDate()+1)}a.day=r,a.hour=configHour();a.minute=[{value:"",text:""}];n=getNow();a.data={day:getDate(n).value,hour:"",minute:""},i.val()&&(a.data={day:i.data("date"),hour:i.data("time"),minute:"00"});var s=0;function f(e,t){var a=t,i="<li></li><li></li>";$.each(a,function(e,t){"00"===t.value?i+='<li data-value="'+t.value+'" class="selected">'+t.text+"</li>":i+='<li data-value="'+t.value+'">'+t.text+"</li>"}),i+="<li></li><li></li>",e.minute.find("ul").html(i)}function g(e){var t=configHour(),a="<li></li><li></li>";$.each(t,function(e,t){"00"===t.value?a+='<li data-value="'+t.value+'" class="selected">'+t.text+"</li>":a+='<li data-value="'+t.value+'">'+t.text+"</li>"}),a+="<li></li><li></li>",e.hour.find("ul").html(a)}a.onChange=function(e,t,a,u){if("minute"!==t){if("day"===t){var r=getAddHours(i);a.day.find("li .selected").data("value")==getDate(n).value?(a.hour.find("li").each(function(){if($(this).data("value")){var e=Number($(this).data("value"));if(e===r&&0==s){$(this).data("value");$(this).before('<li data-value="now" class="selected">现在出发</li>'),s=1}e<r&&$(this).remove()}}),f(a,[])):a.day.find("li .selected").data("value")==o?(s=0,g(a),a.hour.find("li").each(function(){$(this).data("value")&&(Number($(this).data("value"))<r&&$(this).remove())}),f(a,configMinute())):(s=0,g(a),f(a,configMinute())),u.hour&&(u.hour.refresh(),a.hour.find("ul").animate({translate:"0px,0px"},"fast","linear"))}if("hour"===t){var l=getAddMinutes(i),d=(r=getAddHours(i),a.hour.find("li .selected")),v=a.day.find("li .selected");"now"!=d.data("value")?(f(a,configMinute()),v.data("value")===o&&Number(d.data("value"))===r&&$.each(a.minute.find("li"),function(e,t){if($(this).data("value")){var a=$(this).data("value");if(!(l>=a))return $(this).addClass("selected"),!1;$(this).remove()}})):f(a,[]),u.minute&&(u.minute.refresh(),a.minute.find("ul").animate({translate:"0px,0px"},"fast","linear"))}}},$.timePicker(a,function(e,a){if(a.hour&&("now"==e.hour?i.val("今天 现在出发"):i.val(a.day+" "+a.hour+" "+a.minute),i.data("date",e.day),i.data("time",e.hour),i.data("minute",e.minute),null!=t&&"function"==typeof t)){var u={date:e.day,time:e.hour,minute:e.minute};t(u)}})}